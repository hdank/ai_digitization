<?xml version="1.0" encoding="utf-8"?>
<odoo>
    
    <!-- Inherit Employee Form View -->
    <record id="view_employee_form_ai_extraction" model="ir.ui.view">
        <field name="name">hr.employee.form.ai.extraction</field>
        <field name="model">hr.employee</field>
        <field name="inherit_id" ref="hr.view_employee_form"/>
        <field name="arch" type="xml">
            <!-- Add AI extraction button in the header (always visible) -->
            <xpath expr="//header" position="inside">
                <!-- Open wizard button - always visible -->
                <button name="action_open_extract_wizard" 
                        string="Extract with AI" 
                        type="object" 
                        class="oe_highlight"
                        help="Extract information from attached documents using AI"/>
            </xpath>
            
            <!-- Add AI extraction interface in a notebook page for a cleaner look -->
            <xpath expr="//notebook" position="inside">
                <page string="AI Document Extraction" name="ai_document_extraction">
                    <div class="o_attachment_ai_extraction" style="padding: 15px;">
                        <div class="row">
                            <div class="col-md-8">
                                <h5 class="mb-3">
                                    <i class="fa fa-robot me-2 text-primary"></i>
                                    AI Document Extraction
                                </h5>
                                <p class="text-muted mb-3">
                                    View results from AI document extraction
                                </p>
                                <div class="mb-3">
                                    <button name="action_open_extract_wizard" 
                                            string="Extract Document Data" 
                                            type="object" 
                                            class="btn btn-primary"
                                            help="Extract information from attached documents using AI"/>
                                </div>
                            </div>
                            <div class="col-md-4 text-end">
                                <div class="alert alert-info mb-0 mt-2" 
                                     invisible="ai_has_attachments"
                                     style="font-size: 12px; padding: 8px;">
                                    <i class="fa fa-info-circle me-1"></i>
                                    Upload documents first to extract data
                                </div>
                                <!-- Display information about selected AI agent -->
                                <div class="alert alert-info mb-0 mt-2" 
                                     invisible="not ai_agent_id"
                                     style="font-size: 12px; padding: 8px;">
                                    <i class="fa fa-robot me-1"></i>
                                    <strong>Selected AI Agent:</strong> <field name="ai_agent_id" readonly="1" nolabel="1"/>
                                </div>
                            </div>
                        </div>
                    
                    <!-- Status badge - only show when there's a status -->
                    <div class="d-flex align-items-center mt-2" invisible="ai_extract_state == 'no_extract'">
                        <span class="badge bg-success text-white me-2" 
                              invisible="ai_extract_state != 'done'">
                            <i class="fa fa-check me-1"></i>AI Extraction Complete
                        </span>
                        <span class="badge bg-warning text-dark me-2" 
                              invisible="ai_extract_state != 'processing'">
                            <i class="fa fa-spinner fa-spin me-1"></i>Processing...
                        </span>
                        <span class="badge bg-danger text-white me-2" 
                              invisible="ai_extract_state != 'error'">
                            <i class="fa fa-exclamation-triangle me-1"></i>Extraction Error
                        </span>
                        <span class="badge bg-secondary text-white me-2" 
                              invisible="ai_extract_state != 'pending'">
                            <i class="fa fa-clock-o me-1"></i>Pending
                        </span>
                    </div>
                    
                    <!-- Error message display -->
                    <div class="mt-3 alert alert-danger" 
                         invisible="ai_extract_state != 'error'">
                        <strong>Error:</strong> <field name="ai_extract_error" readonly="1" nolabel="1"/>
                    </div>
                    
                    <!-- Extracted Data - Always visible when state is 'done' -->
                    <div class="mt-3" invisible="ai_extract_state != 'done'">
                        <div class="card shadow-sm">
                            <div class="card-header py-2 bg-light d-flex justify-content-between align-items-center" 
                                 data-bs-toggle="collapse" data-bs-target="#ai_extracted_data" 
                                 role="button" aria-expanded="true" aria-controls="ai_extracted_data">
                                <h6 class="mb-0 text-primary">
                                    <i class="fa fa-database me-2"></i>
                                    Extracted Data
                                </h6>
                                <i class="fa fa-chevron-down"></i>
                            </div>
                            <div class="collapse show" id="ai_extracted_data">
                                <div class="card-body p-0" style="max-height: 300px; overflow-y: auto;">
                                    <field name="ai_extract_json" widget="text" readonly="1" 
                                           options="{'no_resize': true}" 
                                           style="font-family: 'Courier New', monospace; font-size: 12px; width: 100%; border: none; padding: 10px; background: transparent;"/>
                                </div>
                            </div>
                        </div>
                    </div>
                    </div>
                </page>
            </xpath>
        </field>
    </record>

    <!-- Partner Form View - Disabled for now -->

</odoo>